-- Практическое задание по теме “Операторы, фильтрация, сортировка и ограничение. 
-- Агрегация данных”

-- Работаем с БД vk и тестовыми данными, которые вы сгенерировали ранее:

-- 1. Создать и заполнить таблицы лайков и постов.
USE vk;

DROP TABLE IF EXISTS likes;
CREATE TABLE likes (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  user_id INT UNSIGNED NOT NULL,
  target_id INT UNSIGNED NOT NULL,
  target_type_id INT UNSIGNED NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Таблица типов лайков
DROP TABLE IF EXISTS target_types;
CREATE TABLE target_types (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL UNIQUE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO target_types (name) VALUES 
  ('messages'),
  ('users'),
  ('media'),
  ('posts');

-- Заполняем лайки
INSERT INTO likes 
  SELECT 
    id, 
    FLOOR(1 + (RAND() * 100)), 
    FLOOR(1 + (RAND() * 100)),
    FLOOR(1 + (RAND() * 4)),
    CURRENT_TIMESTAMP 
  FROM messages;

 -- Создадим таблицу постов
DROP TABLE IF EXISTS posts;
CREATE TABLE posts (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  user_id INT UNSIGNED NOT NULL,
  community_id INT UNSIGNED,
  head VARCHAR(255),
  body TEXT NOT NULL,
  media_id INT UNSIGNED,
  is_public BOOLEAN DEFAULT TRUE,
  is_archived BOOLEAN DEFAULT FALSE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

INSERT INTO `posts` VALUES (99,40,19,'Corporis delectus et deserunt autem sit.','Blanditiis quisquam necessitatibus similique quam. Amet et minima aut dolorem. Ab repellat cupiditate minima architecto et.',47,0,0,'2017-10-19 02:13:46','2020-08-08 02:14:33'),(2,41,15,'Reiciendis quidem sit voluptatibus atque voluptatem ex ea.','Vero dolores vel maxime exercitationem eveniet velit. Dicta explicabo qui eaque eveniet. Magni officiis quia placeat fugiat. Aliquam nobis aspernatur dolores incidunt ut ipsa voluptas.',37,0,1,'2015-05-02 16:50:04','2020-06-12 10:06:44'),(3,56,6,'Quia quia iusto iste nemo quis ipsum.','Adipisci non quia natus et ipsum eos. Nesciunt rerum suscipit dolores qui similique ipsam autem maxime.',62,0,1,'2011-03-19 03:21:31','2020-07-27 22:36:36'),(4,25,19,'Adipisci quia hic molestiae.','Beatae et consequatur at a exercitationem saepe ea. Quo modi voluptas ipsum maiores. Molestias quidem voluptas maxime minus est non itaque.',57,1,0,'2015-10-12 19:27:12','2020-03-23 00:23:59'),(5,69,15,'Sed in qui consequatur ut est sapiente.','Ex nesciunt beatae facilis. Iure omnis officia consectetur aut quos deserunt. Aspernatur vel debitis dolorum. Nulla iste beatae et voluptas non velit ut.',70,1,0,'2014-01-16 13:50:15','2020-12-20 04:22:40'),(6,67,20,'Alias a accusantium quis saepe ut sunt.','Autem rem molestiae possimus iusto. Odio sequi laboriosam nobis fugiat quia reiciendis.',62,0,0,'2016-01-29 20:40:41','2020-08-21 12:53:45'),(7,47,2,'Voluptatem quis nisi in pariatur.','Minima molestias doloribus maiores numquam maiores sint et. Et at quis id aut vel voluptates corrupti. Sit necessitatibus aliquam mollitia minima consequatur perspiciatis porro.',86,1,1,'2017-07-05 23:45:05','2021-01-17 05:10:27'),(8,55,18,'Nihil in soluta mollitia fugit numquam dicta.','Ducimus molestiae nisi qui ratione officia animi. Fuga quos culpa est voluptas perferendis ipsum aliquid. Ipsa labore ducimus animi ullam. Veritatis fugit quos et deleniti voluptas aut.',94,1,1,'2013-10-20 01:36:42','2020-06-22 18:49:19'),(9,52,10,'Voluptatem libero nulla voluptatum voluptatibus voluptas.','Provident similique sit ipsum nobis et. Mollitia commodi et quasi molestiae consectetur iste dolor eveniet. Est et quas cumque et.',47,0,1,'2014-08-24 14:19:48','2020-03-23 11:14:54'),(10,65,18,'Excepturi tenetur exercitationem tenetur culpa consequatur incidunt.','Ea sunt qui voluptatum tempora. Quo et quisquam maxime.',100,0,1,'2012-12-09 13:14:15','2020-06-20 00:06:32'),(11,9,1,'Unde molestias nisi similique nisi.','Voluptas et voluptas nesciunt ipsa aut aliquam omnis. Voluptas mollitia officiis commodi pariatur voluptas maiores.',2,0,0,'2011-05-20 00:08:49','2020-10-21 01:55:33'),(12,77,7,'Voluptatem omnis atque quis perspiciatis nemo nihil sit.','Molestias consectetur vel provident minus consectetur vero velit reiciendis. Temporibus fugiat deleniti eveniet enim. Ducimus aut vitae quidem dignissimos exercitationem inventore. Corporis assumenda quis ipsa voluptas non quia qui.',26,0,0,'2012-11-17 18:24:41','2020-09-26 18:21:08'),(13,45,20,'Eos consequatur esse eaque quo nihil.','Dolorem repellat quod sit quo nisi voluptates deserunt dolor. Aliquam sequi libero quo et fugiat nihil. Libero doloribus similique porro quo et sint incidunt consequuntur.',28,0,0,'2019-10-25 17:47:43','2021-02-13 02:19:16'),(14,55,14,'Expedita asperiores dignissimos et quis.','Aliquam est sed autem eaque ut labore officia. Eos dolorem qui eveniet itaque esse in. Quia sit magnam aut numquam et autem. Expedita pariatur expedita quam voluptatem.',17,1,1,'2011-06-05 14:21:24','2020-06-21 14:15:18'),(15,56,2,'Pariatur ipsa porro enim ut voluptas.','Id ad totam non aut enim sed nostrum. Impedit voluptatem est illo voluptas dolores amet ut. Non fuga quia sit eos optio maxime rem. Pariatur sed incidunt ad et.',97,0,0,'2011-08-27 15:20:24','2020-09-13 17:51:41'),(16,66,15,'Minus sapiente vitae odit quas sint.','Rerum voluptate corrupti illum ea id ipsam. Illo dolore quos sit voluptas aut ad.',14,0,1,'2016-10-31 23:34:54','2021-02-12 06:05:14'),(17,87,12,'Corrupti et maxime voluptate quidem aperiam nisi.','Sequi ea est dolores consequuntur. Similique sunt esse vel voluptas quae eos. Soluta sequi voluptate et.',70,0,1,'2016-08-17 07:36:05','2020-11-21 18:08:25'),(18,22,8,'Libero sunt sint fugit rem id.','Rerum ducimus cum minima sit odio. Laboriosam inventore maiores pariatur placeat officia eaque libero. Ut voluptatem recusandae aliquam eos ullam expedita. Repellat veritatis harum autem quis.',100,0,1,'2020-12-23 17:21:06','2020-07-05 09:10:40'),(19,12,15,'Et nemo voluptatum repudiandae doloremque iure officia.','Soluta omnis non autem architecto. Est natus possimus est similique et optio explicabo. Distinctio expedita doloremque labore nobis qui sit. Saepe at distinctio eveniet velit nulla.',19,1,1,'2018-12-25 22:09:52','2020-07-15 12:44:19'),(20,53,11,'Voluptatem molestias ipsum eveniet in.','Quam deleniti vero molestiae eius. Rerum hic et facere aut. Consectetur aperiam labore quam tenetur.',85,0,0,'2016-09-24 15:15:39','2020-11-07 19:04:49'),(21,39,14,'Quia a rem placeat consequatur qui nihil.','Inventore praesentium nam optio totam quia quod possimus. Ipsa fugit eligendi non velit enim tempore eum hic. Voluptatem at veniam sapiente est necessitatibus ad. Fugiat non doloremque atque. Reiciendis quis quidem saepe optio.',38,0,1,'2019-04-23 09:30:11','2020-05-21 08:43:06'),(22,8,17,'Omnis vel vero esse impedit soluta est corporis.','Rerum eaque odio soluta maiores occaecati dolorem necessitatibus. Voluptatem non dolorem non totam. Est harum quod error.',97,1,1,'2020-06-08 14:39:47','2020-04-22 05:03:45'),(23,62,12,'Consequuntur magnam quia voluptas vitae.','Incidunt omnis ut et omnis dolores. Laborum autem tenetur iure iure repellat ut fugit. Delectus beatae aut nihil tempore. Animi numquam similique molestiae officia.',40,0,1,'2020-04-08 01:33:12','2020-10-08 17:40:16'),(24,57,11,'Qui id molestiae mollitia quisquam et.','Sit sint et quisquam harum at repudiandae. Eaque ut neque ducimus nulla nihil. Alias id similique saepe distinctio eligendi. Et commodi magnam earum hic soluta aut.',92,0,1,'2014-03-04 07:12:45','2020-06-23 02:00:29'),(25,15,7,'Aperiam quia hic ut exercitationem et.','Nesciunt recusandae animi sit magni est exercitationem. Cum quod quis maiores dolore voluptatum quaerat ut. Ratione incidunt perspiciatis dolorum magni ex consequatur consectetur. Sequi nulla id expedita et qui pariatur.',1,1,1,'2019-04-18 00:31:09','2020-10-30 07:55:03'),(26,36,6,'Asperiores eveniet quidem dolorum nesciunt.','Possimus neque unde impedit quasi ut et. Aut voluptas dolorem provident sit dolor consequatur. Molestiae quaerat ut omnis est facere reprehenderit eos.',49,1,1,'2014-01-04 23:31:19','2021-02-18 09:41:18'),(27,66,11,'Ut hic nulla aliquam nulla.','Quisquam in quod explicabo nihil animi illum ut. Doloremque iure et repudiandae optio ut. Omnis exercitationem qui sunt perspiciatis exercitationem. Atque voluptatem sint illo corrupti omnis.',67,1,1,'2016-03-23 14:44:28','2020-06-24 21:41:47'),(28,9,16,'Voluptas autem non quos at doloribus.','Ut et ipsum incidunt velit. Sed impedit fugit dolores qui quod dolorem voluptatum dolor. Beatae blanditiis id deserunt exercitationem. Voluptas ullam eligendi sequi quo. Illum tempore eligendi aliquid placeat sit.',7,0,1,'2018-04-26 20:34:20','2020-09-11 13:44:00'),(29,82,11,'Quia facere architecto numquam officiis ipsum.','Ut dolor aspernatur minima natus. Consequatur atque et facere nam quia libero eum. Beatae deserunt quos et omnis rem autem asperiores.',38,1,1,'2018-04-12 02:11:33','2020-12-01 08:07:29'),(30,62,19,'Molestiae aut aut in impedit non voluptatibus voluptas.','Totam nihil quis architecto eaque aliquam quidem rem placeat. Sint eos consequatur voluptatem rem. Officia odit debitis incidunt enim in excepturi. Ex nobis et non.',83,1,1,'2018-01-16 18:40:20','2020-09-04 08:42:03'),(31,10,13,'Illum sed eaque aspernatur eos saepe.','Repellat tempora aut quia illum. Eum temporibus a quia. Est enim quo aliquam provident voluptas. Dolor eos adipisci quo quaerat ipsum.',100,1,1,'2020-04-30 12:58:35','2020-09-20 03:15:12'),(32,58,12,'Iure aperiam eum quod aliquid voluptatem nihil blanditiis.','Et animi est nemo blanditiis voluptatum corrupti. Impedit et labore tempore corporis asperiores. Officia id assumenda cupiditate ad aspernatur quia et esse.',70,0,1,'2016-01-19 22:33:06','2020-06-17 01:12:17'),(33,49,3,'Qui nobis vitae nisi repellat libero doloribus cupiditate.','Totam vel nesciunt accusantium architecto voluptatem vero. Est quia et commodi dolore eum sunt voluptates. Beatae est cum sit et aut ipsum. Voluptatibus ut numquam perspiciatis praesentium.',26,1,1,'2013-08-02 21:44:17','2020-05-31 16:56:46'),(34,11,6,'Dolores qui beatae voluptatem id consequatur dolores occaecati.','Incidunt perferendis placeat consectetur. Saepe sunt rerum aut et quis rerum rerum. Perspiciatis et animi est et.',52,0,0,'2015-03-06 18:58:16','2020-06-07 00:35:40'),(35,84,5,'Omnis dolore ullam voluptatem minima ad.','Et amet sed distinctio sed voluptate fugiat. Nemo explicabo ut eaque nobis dicta cupiditate consequatur. Laborum asperiores molestiae totam placeat necessitatibus saepe ratione. Dicta rerum minus non non ut dolores.',80,0,1,'2011-06-03 04:20:49','2020-10-23 08:53:23'),(36,34,4,'Itaque impedit temporibus architecto adipisci aut consequatur.','Cupiditate rerum sint a et esse dolores quis. Repellat est assumenda sint expedita fugit eaque quisquam. Maiores possimus nam non saepe quam consequatur.',79,1,1,'2016-05-18 03:42:41','2020-08-24 14:26:11'),(37,22,17,'Est repudiandae unde a tenetur id exercitationem earum.','Adipisci incidunt nihil error qui qui. Facilis nihil officiis ut voluptatem ut reprehenderit.',61,1,0,'2012-08-20 09:17:28','2021-01-10 21:04:42'),(38,76,9,'Voluptatem tenetur id voluptatibus veniam.','Non voluptatem itaque ab. Molestiae omnis aspernatur corrupti aut nam ex. In omnis nobis sit fuga suscipit et inventore. Et occaecati tenetur est corporis debitis qui maiores.',6,0,0,'2013-12-28 19:10:00','2020-04-15 08:14:26'),(39,98,9,'Harum doloremque est atque quae tenetur.','Eum accusamus saepe numquam id quaerat doloremque accusamus. Voluptatem aut facere laborum. Fugiat odit non odio dolore est.',99,1,0,'2020-01-08 01:31:46','2020-04-23 12:40:19'),(40,93,14,'Id et necessitatibus ut animi non animi.','Aut ut magnam aperiam repellendus. Ex quo maiores nostrum expedita vel est. Ratione aliquid autem sed et unde aperiam. Esse alias enim quasi ducimus quia a.',80,0,0,'2016-05-13 02:59:30','2020-03-26 14:45:40'),(41,40,16,'Quae earum sunt consequatur asperiores enim.','Quidem iure est ea voluptas cum illo maiores. Ducimus ex rerum nam totam perferendis cumque. Consequatur tempora vel reprehenderit quod qui. Nulla voluptatem impedit fugiat.',3,0,1,'2019-07-19 19:41:12','2020-06-18 14:38:10'),(42,86,5,'Quis aut est perspiciatis blanditiis ut repellendus consectetur fugit.','Voluptatem odio sit nihil reprehenderit et rerum. Nisi ut est aperiam error iure. Aliquam culpa facere quo molestiae accusantium. Quia fuga ea facere aliquid quia sit.',97,0,0,'2011-05-07 04:02:31','2020-11-17 11:17:03'),(43,7,4,'Et aliquid deleniti qui et id perferendis.','Eum dolorem nihil minima voluptas. Ut architecto quibusdam nulla rerum aut praesentium. Consequuntur perferendis omnis odio consequatur. Doloremque magnam vero at fuga ut.',93,0,0,'2016-06-14 09:30:43','2020-05-11 15:45:27'),(44,1,18,'Quisquam maxime ut non.','Architecto voluptatem totam occaecati nihil eum quo facilis. Aut consectetur molestiae iste vel. Et praesentium consectetur sunt rerum quasi quia rerum excepturi. Quisquam non illum id rerum.',2,1,1,'2017-03-02 18:00:31','2020-07-22 20:04:28'),(45,48,10,'Rerum libero asperiores sit et cumque quis assumenda.','Adipisci ad nobis iste accusamus sunt nam ullam optio. Autem mollitia voluptas deserunt expedita perspiciatis voluptate quidem.',8,0,1,'2020-04-29 02:01:22','2020-06-11 06:05:33'),(46,71,19,'Sunt fuga vel ab tempora maxime cumque reprehenderit.','Perspiciatis corrupti impedit nihil porro quidem facere. Quasi qui laboriosam molestiae non fugiat. Vitae assumenda quia doloribus ut accusamus possimus.',83,0,0,'2019-07-09 21:36:11','2020-10-08 15:06:22'),(47,75,19,'Aut eius ut dolorem.','Eaque veniam ea eaque. Dolorum delectus illo aspernatur laborum. Fuga odio dolorem optio sit reprehenderit et consequuntur.',15,0,0,'2020-07-21 03:42:24','2020-06-10 09:14:39'),(48,95,7,'Aut doloremque deleniti in laudantium dolore perferendis commodi.','Fugit ducimus sint quaerat doloremque ut ut incidunt. Laboriosam repudiandae ut aspernatur ad maxime. Fuga rem voluptatem aut ea. Rerum reprehenderit voluptas quasi dolores id et.',22,0,1,'2011-06-27 17:26:25','2021-01-03 15:16:28'),(49,89,15,'Maiores quasi illum aut minus aliquid dignissimos.','Amet voluptatem sit ab. Fugit perspiciatis neque tempore dolorem harum at occaecati.',13,1,1,'2018-05-14 19:09:54','2020-09-28 20:37:33'),(50,55,6,'Laudantium et unde distinctio consectetur recusandae expedita.','Aliquam minus ut voluptatem qui et iusto. Unde et eum dolor possimus. Ipsum rem exercitationem tempora.',48,1,0,'2017-06-19 16:00:38','2020-07-03 09:10:09'),(51,17,3,'Architecto fuga placeat rerum nobis.','Exercitationem quo inventore id omnis quisquam eos. Odit dolorum quidem labore provident ut voluptas. Rerum ea nulla distinctio sunt voluptatem accusamus qui numquam.',36,1,1,'2020-02-21 05:40:20','2020-11-26 04:53:04'),(52,81,16,'Aut aliquam alias sit delectus quidem.','Quas aut est provident repellat vel. Sint aut eos voluptas numquam fugiat enim. Non hic eveniet dolores non accusantium.',28,1,1,'2014-04-14 15:20:42','2020-07-11 04:32:57'),(53,31,6,'Doloribus soluta temporibus nemo.','Nisi praesentium inventore placeat. Consectetur sequi ipsam aspernatur illum vero quos id molestiae. Quos voluptatum ad natus est. Qui deserunt facere quo possimus pariatur ut inventore.',12,1,0,'2020-06-21 18:13:51','2020-10-01 12:15:06'),(54,86,18,'Aut id sit laborum rem veniam maxime repellat.','Quia vero pariatur voluptas fugiat dolorem amet. Aliquam laborum ipsum sit harum reiciendis. Minus necessitatibus odio iure et facere veniam qui at.',61,0,1,'2019-04-08 00:57:25','2021-02-01 19:52:22'),(55,42,15,'Ipsum sint voluptate iste exercitationem occaecati asperiores totam.','Et minus aperiam id cumque. Aut fuga nulla ut earum esse quis. Tenetur id deleniti distinctio reiciendis doloribus fugiat consequatur.',66,1,0,'2018-07-14 05:55:52','2020-11-14 02:00:43'),(56,12,18,'Numquam inventore vel natus rerum iure temporibus dolor rem.','Aliquam quia assumenda totam enim unde id. Architecto libero qui iste ea. Placeat officia corrupti accusantium. Aliquam dolorum omnis exercitationem qui dolorem est vitae. Rerum iusto dolorem sint in sunt rerum amet ea.',74,0,1,'2019-03-16 16:29:00','2020-03-29 13:39:29'),(57,79,5,'Excepturi perspiciatis provident facilis aut.','Qui quis consequatur corrupti labore aliquam sed. Enim dolor quia amet iusto commodi et. Sint tempora et dolores corporis debitis libero ea.',59,1,1,'2018-10-04 09:51:25','2021-02-14 11:44:04'),(58,45,18,'Sint perferendis eveniet in autem.','Quisquam occaecati adipisci autem atque. Quo commodi sapiente dignissimos et quidem sed itaque. Qui esse ducimus mollitia molestiae non praesentium. Amet non id voluptas quo voluptates ipsum blanditiis.',43,0,1,'2016-02-01 02:33:52','2020-04-06 16:56:20'),(59,98,12,'Nihil laborum rerum quasi alias quo quaerat iste.','Quia eum reiciendis reiciendis voluptas autem earum et. Sed id laboriosam iusto aliquid quo non molestias quia. Aut temporibus quia laudantium non omnis.',45,0,1,'2011-05-27 22:53:11','2020-04-03 12:44:42'),(60,16,1,'Aliquam ut non ipsam ullam.','Laboriosam dolores assumenda ipsum delectus et hic. Et necessitatibus inventore fugit aut consequuntur vero dolores. Amet atque fugiat eveniet unde veritatis dolores. Iure et possimus ut eaque voluptatem ducimus quibusdam saepe.',43,1,0,'2020-06-03 07:19:22','2020-06-28 11:05:13'),(61,99,10,'Mollitia fuga ut beatae tempora quaerat illo modi in.','Sint odio doloribus repellendus. Consectetur praesentium eius et et. Aliquam quo impedit explicabo unde quos deleniti labore. Sequi veritatis repellat exercitationem odio laborum.',24,0,0,'2020-10-09 08:26:16','2020-10-05 05:27:57'),(62,74,6,'Dolores quis veniam id ab consectetur ad.','Dolorem dolorum libero distinctio et enim est. Temporibus recusandae assumenda esse sed repudiandae est. Et voluptatem aliquid fugiat et pariatur ut id.',19,0,1,'2020-09-16 05:47:57','2020-10-25 03:27:07'),(63,83,5,'Est dolorem a omnis harum repellat sed amet.','Optio possimus dolor fugiat est vitae facilis qui. Omnis aperiam itaque fuga debitis quae voluptatem.',97,1,1,'2012-01-24 10:47:46','2021-01-29 03:48:53'),(64,40,17,'Sit facilis iusto sed totam quia natus sequi.','Quo fugit consequatur rerum rerum nostrum in recusandae. Voluptatem aliquam et fugiat quia et aut. Omnis alias eius iste aspernatur nobis. Quia autem recusandae quod sed.',57,1,1,'2011-03-29 09:36:19','2020-11-06 16:05:27'),(65,46,16,'Omnis occaecati expedita est rerum autem.','Soluta est aperiam esse voluptas aut laborum velit maiores. Qui qui autem accusantium amet est vel. Sint eos facilis excepturi corporis quo culpa a cupiditate. Tempore et nihil sed ut sequi et non.',50,0,1,'2020-11-12 18:48:30','2020-12-18 13:16:12'),(66,38,2,'Voluptatibus error corporis voluptatem iure.','Quos consectetur ipsam dicta excepturi et praesentium qui. Enim occaecati rerum aut unde beatae nihil mollitia. Autem sapiente corrupti et nisi animi ut.',15,1,0,'2020-06-11 15:05:18','2021-02-12 07:23:01'),(67,74,13,'Aut rerum qui et voluptatem sunt corrupti non.','Tempora quasi quae et corporis dolorem architecto. Distinctio consequatur velit sed id. Ut est error ipsa aut sed qui quisquam.',54,0,1,'2018-12-28 12:36:55','2020-05-21 04:58:46'),(68,22,20,'Omnis quidem delectus veniam voluptate delectus.','Quia odit vero modi optio ipsam incidunt. Omnis est architecto vel eos sed excepturi. Temporibus reiciendis accusamus rerum consequuntur repellendus quod.',76,0,1,'2016-05-22 17:58:21','2021-02-04 20:57:36'),(69,93,17,'Ratione tempora esse et quos consequuntur iste.','Sit quo quisquam fugiat sed mollitia voluptatum. Quibusdam ducimus praesentium maxime velit sed asperiores veniam. Sit accusantium assumenda tempora.',87,1,1,'2012-10-02 09:35:19','2020-04-20 21:36:55'),(70,18,3,'Eum animi saepe sed aut mollitia voluptatem hic explicabo.','Debitis vitae distinctio qui explicabo quisquam veritatis qui. Pariatur deserunt autem omnis repudiandae quas. Enim in inventore dolores magnam.',49,0,0,'2019-11-18 19:14:29','2020-08-18 18:20:57'),(71,8,11,'Aut qui dicta beatae dicta sint nisi.','In tempore corporis eligendi minus. Sed aut fugit enim quia. Laborum corrupti possimus sed alias dicta autem esse suscipit.',86,1,0,'2019-12-21 05:56:47','2020-11-05 12:04:33'),(72,19,17,'Unde praesentium dolor sint est nesciunt qui quia.','Voluptas totam asperiores et aut dolorem id. Asperiores consequuntur voluptate perferendis neque quae aut. Tenetur voluptatum adipisci non asperiores.',87,1,0,'2015-09-25 17:54:25','2020-10-25 18:59:23'),(73,65,1,'Accusantium enim nam et iusto odit.','Dolorum aut et et et pariatur ad. Delectus necessitatibus similique non. Est et alias necessitatibus omnis.',28,0,0,'2017-08-06 17:39:38','2020-08-18 08:29:37'),(74,11,5,'Est omnis quam est maiores sunt itaque repellat.','Consequatur omnis voluptate ut est beatae at inventore. Tenetur saepe sunt exercitationem nesciunt. Aliquid illum fugiat qui enim. Dolorem quos dicta consectetur voluptatem.',78,0,0,'2015-01-06 19:46:50','2021-01-03 20:19:01'),(75,53,18,'Quod unde aut neque ea quis non harum.','Fugit quis esse quae voluptatibus quisquam. Aliquid consequatur perspiciatis consequuntur sit. Magni consequatur aut atque quis nisi. Eum non aperiam porro illum.',24,1,1,'2015-01-30 16:54:48','2021-02-07 04:57:20'),(76,8,15,'Non consequatur dolore asperiores sit quasi consequatur.','Molestiae unde et aspernatur itaque explicabo voluptatum. Quia asperiores laudantium aut et iure. Nulla tenetur consequatur molestiae voluptates.',75,0,0,'2017-12-08 06:45:09','2020-03-13 15:03:32'),(77,59,16,'Eaque aut et ipsam ipsam provident ut modi voluptatem.','Itaque voluptates dicta fugiat. Minima ut tenetur ullam voluptatibus.',87,1,1,'2012-11-03 11:38:48','2020-11-01 10:28:14'),(78,33,14,'Quia earum ullam sit reprehenderit quis omnis.','Ipsam dolores amet omnis quod eos consectetur incidunt magnam. Sunt nisi nihil repudiandae quis. Mollitia quisquam velit officia natus ut. Voluptatum quasi aut nobis error consectetur excepturi quis.',3,1,0,'2015-02-14 12:02:57','2020-03-25 08:06:21'),(79,52,18,'Eaque tenetur quia veniam blanditiis nostrum velit aspernatur.','Aut voluptatem ipsa omnis quod ea. Voluptatem illo et et error eos voluptates provident libero. Dolore enim illum quae alias impedit. Illum doloremque ipsam eos.',36,0,0,'2015-09-30 02:37:09','2021-01-12 11:49:31'),(80,3,2,'Perspiciatis et in dolorem placeat et voluptatum corporis.','Eum autem et exercitationem autem et quisquam. Ipsum illum aut at ea voluptas odio ab rem. Libero sed aut unde aut. Nisi laborum aut sint qui consequatur pariatur qui itaque.',79,1,1,'2019-04-14 04:31:35','2020-10-22 17:18:13'),(81,88,19,'Fugiat molestiae quia et amet qui aut sed molestiae.','Est natus iste ut fugit. Nihil ratione alias porro dignissimos voluptatem. Libero architecto sunt repellendus est reprehenderit alias et. Voluptas recusandae temporibus rerum enim.',97,0,1,'2015-01-18 02:03:42','2020-06-17 10:00:02'),(82,75,3,'Provident qui maiores ut impedit nesciunt exercitationem.','Dolor excepturi debitis consequuntur sequi voluptas. Earum quos nisi ipsa minus et. Minima culpa vel vero adipisci quia.',95,0,0,'2014-04-12 11:47:25','2020-08-10 09:06:07'),(83,52,9,'Id corrupti quam aut excepturi.','Adipisci ut illum reprehenderit veritatis qui. Consequatur est itaque voluptas.',4,1,1,'2017-03-26 22:23:02','2020-12-05 07:41:16'),(84,22,16,'Delectus exercitationem adipisci quia ratione.','Natus enim nobis et labore occaecati labore quasi. Eum ut delectus facilis non explicabo laudantium dignissimos. Alias consequatur totam sit animi inventore harum. Eligendi ea quos et quis corrupti aperiam.',31,1,1,'2020-08-05 23:50:57','2020-11-18 16:09:45'),(85,88,18,'Perferendis non veniam dolores sunt reiciendis.','Autem labore esse eveniet ea deserunt et. Laudantium aperiam distinctio cumque necessitatibus est. Et provident unde modi assumenda deserunt omnis.',56,1,1,'2011-07-20 09:34:47','2020-03-03 08:24:22'),(86,17,4,'Excepturi earum eius rerum magnam voluptas ea architecto.','Animi quidem repellendus deleniti enim in est vel. Molestiae fuga dolorum et hic aliquam. Consectetur eveniet non et officiis sed non perspiciatis.',3,1,0,'2019-08-10 11:40:25','2020-08-19 23:48:03'),(87,79,8,'Ut et nobis quod eligendi animi.','Et voluptatem et inventore praesentium nihil et porro. Illo ut autem nisi eveniet quibusdam quibusdam maiores.',15,1,0,'2013-12-07 11:43:20','2020-08-17 22:35:41'),(88,69,15,'Non odit deserunt quia perferendis sit quia.','Vitae laborum aperiam corporis est beatae quidem. Architecto laborum placeat nisi laudantium a. Omnis sit saepe impedit odio atque dolorem quaerat aut. Eligendi iusto vero libero error.',86,0,0,'2011-11-09 23:04:21','2020-11-03 14:39:14'),(89,54,2,'Ea tenetur repellat consectetur rem quidem.','Ab officiis velit deserunt. Dolorem soluta rerum quia facilis.',53,1,1,'2016-10-13 14:01:58','2021-02-18 05:20:17'),(90,56,6,'Dicta autem voluptas voluptatum velit ex.','Esse tempora quis vel autem sit quibusdam. Id cumque dolor nemo suscipit. Occaecati et necessitatibus adipisci ipsam saepe reprehenderit reiciendis.',17,1,0,'2016-09-07 00:49:38','2020-12-09 09:46:37'),(91,99,9,'Pariatur ut quis cum eveniet et ipsum voluptas.','Ipsam et cum eos. Incidunt sit tempora vitae ducimus. Dicta qui nihil magnam nostrum libero.',81,0,1,'2011-07-25 03:30:21','2020-07-07 11:43:00'),(92,58,1,'Iste ea facilis nostrum iure.','Neque veniam doloribus quia non ad numquam. Quaerat quisquam omnis enim explicabo beatae. Cumque ut nostrum architecto ducimus enim id.',24,1,0,'2013-01-05 10:36:57','2020-03-10 13:33:39'),(93,13,17,'Quos et placeat mollitia quas nihil.','Pariatur dolorem repudiandae in nesciunt fuga nesciunt. Repellendus tempora harum et beatae rerum vel aperiam. Recusandae distinctio laborum in ratione voluptates.',99,0,1,'2016-07-01 16:48:41','2020-09-04 15:08:38'),(94,35,3,'Sunt eos non iste veniam unde et natus et.','Quia earum voluptatem perferendis aliquam est ipsam est. Inventore qui facere est ut ut a non. Enim nihil quia earum sunt id quisquam aut.',87,0,0,'2014-02-12 04:01:08','2021-01-03 00:24:18'),(95,76,16,'Enim ipsa molestiae omnis eveniet.','Adipisci fugit ad vel error. Odio omnis quidem quia velit aperiam excepturi accusamus vero. Ex voluptatum eveniet quia magnam. Ea qui incidunt odit voluptatem qui.',82,1,0,'2021-01-05 14:04:51','2020-09-06 20:16:42'),(96,39,20,'Ipsam iste eos blanditiis architecto iure ut.','Ea quam dolores necessitatibus quis magnam recusandae et. Alias eos quos commodi ea praesentium quis. In dolor recusandae voluptas dolores ipsa. Voluptate et perferendis porro natus molestiae placeat qui.',63,0,0,'2019-09-27 04:31:28','2020-07-30 01:24:12'),(97,40,14,'Qui dolor debitis velit ea.','Sit aspernatur est est qui sint mollitia necessitatibus. Rem aliquid illum sint facere odit qui nesciunt. Aut asperiores laborum quo quae est sed amet.',29,1,1,'2017-10-23 16:31:07','2020-07-10 16:21:21'),(98,34,11,'Est dicta excepturi rerum quis.','Ipsam quaerat eaque molestiae ut. Ut qui facere ut quidem. Aut voluptatem illo doloremque dolorem perspiciatis minus voluptas corrupti. Voluptatum perspiciatis eaque maxime amet exercitationem debitis.',61,1,1,'2017-01-06 02:24:34','2020-04-05 14:51:18'),(99,55,3,'Sequi dolores est ex aperiam rerum maxime.','Minima exercitationem doloribus similique et repellendus veritatis ab. Unde in dolorem eos repellat quisquam iusto. Eos sit cum dolor sit tempora. Enim amet quo eligendi eum necessitatibus.',12,1,1,'2018-05-16 23:54:53','2020-11-12 23:41:17'),(100,21,10,'Provident autem est sit est.','Unde delectus ad amet nesciunt. Placeat eaque eos consequuntur. Fugit aut hic eum quod ullam praesentium. Doloribus qui aspernatur suscipit fugit quibusdam.',15,0,0,'2017-03-12 13:25:24','2021-02-20 04:02:56');


-- 2. Создать все необходимые внешние ключи и диаграмму отношений.

ALTER TABLE posts ADD CONSTRAINT post_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE posts ADD CONSTRAINT post_community_id_fk FOREIGN KEY (community_id) REFERENCES communities(id);
ALTER TABLE posts ADD CONSTRAINT post_media_id_fk FOREIGN KEY (media_id) REFERENCES media(id);
ALTER TABLE communities_users ADD CONSTRAINT communities_users_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE communities_users ADD CONSTRAINT communities_users_community_id_fk FOREIGN KEY (community_id) REFERENCES communities(id);
ALTER TABLE media ADD CONSTRAINT media_type_id_fk FOREIGN KEY (media_type_id) REFERENCES media_types(id);
ALTER TABLE media ADD CONSTRAINT media_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE likes ADD CONSTRAINT likes_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE likes ADD CONSTRAINT target__id_fk FOREIGN KEY (target_id) REFERENCES users(id);
ALTER TABLE likes ADD CONSTRAINT target_type_id_fk FOREIGN KEY (target_type_id) REFERENCES target_types(id);
ALTER TABLE friendship ADD CONSTRAINT friendship_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE friendship ADD CONSTRAINT friendship_friend_id_fk FOREIGN KEY (friend_id) REFERENCES users(id);
ALTER TABLE friendship ADD CONSTRAINT friendship_friendship_status_id_fk FOREIGN KEY (friendship_status_id) REFERENCES friendship_statuses(id);



-- 3. Определить кто больше поставил лайков (всего) - мужчины или женщины?
SELECT COUNT(id),
	(SELECT gender FROM profiles WHERE user_id=likes.user_id) AS gender
FROM likes GROUP BY gender ORDER BY count(id) DESC LIMIT 1; 


-- 4. Подсчитать количество лайков которые получили 10 самых молодых пользователей. 

SELECT 
	(SELECT CONCAT(first_name, ' ', last_name) FROM users WHERE id = user_id) AS users,
	(SELECT COUNT(*) FROM likes WHERE profiles.user_id = user_id) AS likes,	birthday 
FROM profiles ORDER BY birthday DESC LIMIT 10 
  

-- 5. Найти 10 пользователей, которые проявляют наименьшую активность в
-- использовании социальной сети
-- (критерии активности необходимо определить самостоятельно).

SELECT CONCAT(first_name, ' ', last_name) as user_name,
	COALESCE((SELECT COUNT(*) as like_number FROM likes WHERE users.id = likes.user_id GROUP BY user_id), 0) +
	COALESCE((SELECT COUNT(*) as message_number FROM messages WHERE users.id = messages.from_user_id GROUP BY from_user_id), 0) +
	COALESCE((SELECT COUNT(*) as posts_number FROM posts WHERE users.id = posts.user_id GROUP BY user_id), 0) +
	COALESCE((SELECT COUNT(*) as communities_number FROM communities_users WHERE users.id = communities_users.user_id GROUP BY user_id), 0) +
	COALESCE((SELECT COUNT(*) as friends_number FROM friendship WHERE users.id = friendship.user_id GROUP BY user_id), 0) +
	COALESCE((SELECT COUNT(*) as media_number FROM media WHERE users.id = media.user_id GROUP BY user_id), 0)
as activity_summ FROM users ORDER BY activity_summ LIMIT 10;
